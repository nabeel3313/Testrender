{% extends "base.html" %}

{% block title %}Browse Sessions — MentorAI{% endblock %}

{% block content %}

<!-- Page Banner -->
<div class="page-banner">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8 page-banner-inner">
                <div class="page-banner-tag"><i class="fas fa-layer-group"></i> Sessions</div>
                <h1>Available <span class="gradient-text">Training Sessions</span></h1>
                <p>Browse and book sessions from our curated network of expert trainers.</p>
            </div>
        </div>
    </div>
</div>

<!-- Page Content -->
<div class="page-content">
    <div class="container">

        {% if sessions %}
        <div class="row g-4">
            {% for session in sessions %}
            <div class="col-md-6 col-lg-4 fade-in-up">
                <div class="session-card h-100">
                    <div class="session-card-body">

                        <div
                            style="display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:10px;">
                            <div class="session-card-category">
                                <i class="fas fa-tag"></i> {{ session.category|title }}
                            </div>
                            <span
                                class="dp-badge {% if session.difficulty == 'beginner' %}dp-badge-success{% elif session.difficulty == 'intermediate' %}dp-badge-warning{% else %}dp-badge-danger{% endif %}">
                                {{ session.difficulty|title }}
                            </span>
                        </div>

                        <div class="session-card-title">{{ session.title }}</div>
                        <div class="session-card-desc">{{ session.description|truncate(110) }}</div>

                        <div style="margin-top:auto;">
                            <div class="session-meta-item">
                                <i class="fas fa-user-tie"></i>
                                <span>{{ session.trainer.first_name }} {{ session.trainer.last_name }}</span>
                            </div>
                            <div class="session-meta-item">
                                <i class="fas fa-calendar-alt"></i>
                                <span>{{ session.scheduled_time.strftime('%b %d, %Y · %H:%M') }}</span>
                            </div>
                            <div class="session-meta-item">
                                <i class="fas fa-clock"></i>
                                <span>{{ session.duration }} minutes</span>
                            </div>
                        </div>

                    </div>
                    <div class="session-card-footer">
                        <div class="session-card-price">
                            ${{ "%.2f"|format(session.price) }} <span>/ session</span>
                        </div>
                        <button class="btn-primary-custom book-session" data-session-id="{{ session.id }}"
                            style="padding:8px 18px;font-size:0.82rem;">
                            <i class="fas fa-bookmark"></i><span>Book</span>
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        {% else %}
        <div class="empty-state">
            <div class="empty-state-icon"><i class="fas fa-calendar-times"></i></div>
            <h5>No sessions available yet</h5>
            <p>Check back soon — new training sessions are added regularly.</p>
        </div>
        {% endif %}

    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const bookButtons = document.querySelectorAll('.book-session');
        bookButtons.forEach(button => {
            button.addEventListener('click', function () {
                const sessionId = this.getAttribute('data-session-id');
                fetch(`/api/session/${sessionId}/book`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('Session booked successfully!');
                            window.location.href = "{{ url_for('dashboard') }}";
                        } else {
                            alert('Error: ' + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred while booking the session.');
                    });
            });
        });
    });
</script>
{% endblock %}